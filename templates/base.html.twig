<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/superhero/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/css.css">
    <link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans|Lobster" rel="stylesheet">

    {% block stylesheets %}{% endblock %}

</head>
<body>
<div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    {% if app.user %}
        {% if role[0] == 'ROLE_ADMIN' %}
            <p>
                <a class="btn btn-dark bg-primary" style="color: white" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">Animé</a>
            </p>
            <div class="collapse row" align="center" id="collapseExample">
                <a class="titleSiteBlock col-6" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Listes des animés" href="{{ path('list_anime') }}"><img src="../../assets/images/anime/menu/animeList.png" alt="Liste"></a>
                <a class="titleSiteBlock col-6 border-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Ajouter un nouvel animé" href="{{ path('new_anime') }}"><img src="../../assets/images/anime/menu/new.png" alt="Ajout"></a>
            </div>
        {% endif %}
    {% endif %}
    {% if not app.user %}
        <p align="center">
            <a href="#" class="nav-link bg-primary" data-target="#connexion" data-toggle="modal"><span class="links">Connexion</span></a>
        </p>
        <p align="center">
            <a href="#" class="nav-link bg-primary" data-target="#registration" data-toggle="modal"><span class="links">S'inscrire</span></a>
        </p>
    {% elseif app.user %}
        <p align="center" class="mt-3">
            <a class="nav-link bg-primary" style="color: white" role="button"  href="{{ path('security_role') }}"><span>Compte</span></a>
        </p>
        <p align="center">
            <a class="nav-link bg-primary" style="color: white" role="button" href="{{ path('security_logout') }}"><span>Déconnexion</span></a>
        </p>
    {% endif %}
</div>
<div id="backCan" onclick="toggleNav()"></div>

<!-- Use any element to open the sidenav -->

<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
    <div class="text-center">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav mr-auto" id="fixNav" style="align-items: center">
                    <div id="buttonNav" class="offNav nav-icon2 m-3" onclick="toggleNav()">
                        <span class="bg-dark"></span>
                        <span class="bg-dark"></span>
                        <span class="bg-dark"></span>
                        <span class="bg-dark"></span>
                        <span class="bg-dark"></span>
                        <span class="bg-dark"></span>
                    </div>
                </ul>
                <ul class="navbar-nav mr-auto" style="align-items: center">
                    <li class="nav-item">
                        <a class="navbar-brand pl-3 pr-3" style="color: white; position: relative; left: 100px" href="{{ path('security_home') }}"><h1 class="titleSite">Manga-K</h1></a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    {% block body %}{% endblock %}
</div>


<!--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Modal Connexion !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->

<div class="modal fade" id="connexion" tabindex="-1" role="dialog" aria-labelledby="connexion" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content familiNav">
            <div class="modal-header">
                <h5 class="modal-title" id="connexion">Inscription</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form action="{{ path('security_login') }}" method="post">
                    <div class="form-group">
                        <input type="text" id="pseudo" placeholder="Pseudo" required name="_username" value="{{ last_username }}"
                               class="form-control">
                    </div>
                    <div class="form-group">
                        <input type="password" id="mdp" placeholder="Mot de passe" required name="_password" class="form-control">
                    </div>
                    <div class="container">
                        <div class="modal-footer row justify-content-between">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                            <button type="submit" class="btn btn-primary">Link start !</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Modal registration !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->

<div class="modal fade" id="registration" tabindex="-1" role="dialog" aria-labelledby="registration" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content familiNav">
            <div class="modal-header">
                <h5 class="modal-title" id="registration">Inscription</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body registration_body">
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js" integrity="sha384-FzT3vTVGXqf7wRfy8k4BiyzvbNfeYjK+frTVqZeNDFl8woCbF0CYG6g2fMEFFo/i" crossorigin="anonymous"></script>
<script src="../assets/js/js.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js"></script>
<script>
    //  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!   Ajax pour l'inscription   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    $(document).ready(function () {
        let modal = $(this);
        $.ajax('{{ path('registration') }}', {
            success: function(data) {
                modal.find('.modal-body.registration_body').html(data);
            }
        });

        $('#registration').submit(function (e) {
            // il est impératif de commencer avec cette méthode qui va empêcher le navigateur d'envoyer le formulaire lui-même
            e.preventDefault();

            $form = $(e.target);
            modal = $('#registration');

            let $submitButton = $form.find(':submit');
            $submitButton.html('<i class="fas fa-spinner fa-pulse"></i>');
            $submitButton.prop('disabled', true);

            // ajaxSubmit du plugin ajaxForm nécessaire pour l'upload de fichier
            $form.ajaxSubmit({
                type: 'post',
                success: function (data) {
                    if (data === 'success') {
                        modal.modal('hide');
                    } else {
                        console.log(data);
                        modal.find('.modal-body.registration_body').html(data);
                    }
                }
            });
        });
    });
</script>
<script>
    /* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!   Off-Canvas   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */
    function closeNav() {
        document.getElementById("buttonNav").classList.replace('onNav', 'offNav');
        document.getElementById("mySidenav").style.width = "0";
        setTimeout(function () {
            document.getElementById("backCan").style.width = "0";
            document.getElementById("backCan").style.height = "0";
        }, 500);
        document.getElementById("main").style.marginLeft = "0";
        document.getElementById("backCan").style.backgroundColor = 'transparent';
        document.getElementById("backCan").style.opacity = '0';
        document.getElementById("buttonNav").classList.remove('open')
    }

    function toggleNav() {
        if (document.getElementById("buttonNav").classList.contains('offNav')) {
            document.getElementById("buttonNav").classList.replace('offNav', 'onNav');
            document.getElementById("mySidenav").style.width = "350px";
            document.getElementById("backCan").style.width = "100%";
            document.getElementById("backCan").style.height = "100%";
            document.getElementById("main").style.marginLeft = "350px";
            setTimeout(function (){
                document.getElementById("backCan").style.backgroundColor = 'black'
            }, 200);
            setTimeout(function (){
                document.getElementById("backCan").style.opacity = '0.5'
            },200);
            document.getElementById("buttonNav").classList.add('open')
        } else {
            document.getElementById("buttonNav").classList.replace('onNav', 'offNav');
            document.getElementById("mySidenav").style.width = "0";
            setTimeout(function () {
                document.getElementById("backCan").style.width = "0";
                document.getElementById("backCan").style.height = "0";
            }, 200);
            document.getElementById("main").style.marginLeft = "0";
            document.getElementById("backCan").style.backgroundColor = 'transparent';
            document.getElementById("backCan").style.opacity = '0';
            document.getElementById("buttonNav").classList.remove('open')
        }
    }
</script>
{% block javascripts %}{% endblock %}
</body>
</html>
