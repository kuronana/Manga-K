{% extends '/security/base_connect.html.twig' %}

{% block title %}Manka-K Compte{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="row">
            <div class="alert alert-dismissible alert-success badFlash col-8 offset-2 mb-5" id="goodFlash" align="center">
                <strong id="name">p</strong>
            </div>
        </div>
        <div class="row mb-5">
            <div class="col-10 offset-1" align="center">
                <div class="card text-white bg-secondary mb-3 newAnime">
                    <h2 class="card-header bg-primary newAnimHead" style="color: white">Modification de {{ anime.name }}</h2>
                    <div class="card-body"  style="color: white">
                        {{ form_start(formUpdateAnime) }}
                        <div class="row">
                            <div class="col-5">
                                <h4 class="card-title">Nom</h4>
                                {{ form_row(formUpdateAnime.name, { 'id': 'animName', 'attr': {'style': 'border-radius: 5px'}}) }}
                            </div>
                            <div class="col-5">
                                <h4 class="card-title">Lien vers l'image</h4>
                                {{ form_row(formUpdateAnime.image, { 'attr': {'class': 'col-12', 'style': 'border-radius: 5px'}}) }}
                            </div>
                            <div class="col-2">
                                <h4 class="card-title">Durée</h4>
                                {{ form_row(formUpdateAnime.duration, { 'attr': {'class': 'col-8', 'style': 'border-radius: 5px'}}) }}
                            </div>
                        </div>
                        <h4 class="card-title">Synopsis</h4>
                        {{ form_row(formUpdateAnime.synopsis, { 'attr': {'style': 'border-radius: 5px'}}) }}
                        <div class="form-group">
                            <h4 class="card-title">Genre(s)</h4>
                            <div class="col-12" align="center">
                                {{ form_row(formUpdateAnime.type, { 'attr': {'class': 'col-12', 'style': 'display: inline-flex;flex-direction: row; justify-content: space-between'}}) }}
                            </div>
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary h col-3" onclick="location.href = '{{ path('animes') }}'">Retour</button>
                            <button type="button" class="btn btn-danger h col-3 offset-1" data-target="#del" data-toggle="modal">Supprimer</button>
                            <button type="submit" class="btn btn-success h col-3 offset-1" id="update">Modifier</button>
                        </div>
                        {{ form_end(formUpdateAnime) }}
                        <div  class="modal fade" id="del" tabindex="-1" role="dialog" aria-labelledby="del" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="text-center pl-5 ml-5">Suppression de {{ anime.name }}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Êtes vous certain de vouloir supprimer cet animé ?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" onclick="location.href = '{{ path('delete_anime', { 'id' : anime.id}) }}'" >Confirmer</button>
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block javascripts %}
    <script>
        $(document).submit(function(e){
// ! il est impératif de commencer avec cette méthode qui va empêcher le navigateur d'envoyer le formulaire lui-même !
            e.preventDefault();

            let form = $(e.target);
            let name = '<strong>' + $('#animName').val() + '<strong>' + ' modifié avec succès !';
            let remove = '<strong>' + $('#animName').val() + '<strong>' + ' supprimé avec succès !';
            let dopple = 'Cet animé est déjà enregistré.';

// !!!!!!!!!!!!!!!!!   ajaxSubmit du plugin ajaxForm nécessaire pour l'upload de donnée dans la db   !!!!!!!!!!!!!!!!
            form.ajaxSubmit({
                type: 'post',
                success: function(data) {
                    if (data === 'success') {

//   !!!!!!!!!!!!!!!!!!!   Changement de l'opacity du flash avec deux effet en setTimeout   !!!!!!!!!!!!!!!!!!!!!!!

                        (document.querySelector('#name')).innerHTML = name;
                        window.setTimeout(function () {
                            $('#goodFlash').toggleClass('badFlash').toggleClass('goodFlash').removeClass('alert-warning').addClass('alert-success');
                            window.setTimeout(function () {
                                $('#goodFlash').toggleClass('goodFlash').toggleClass('goodFlash2');
                                window.setTimeout(function () {
                                    $('#goodFlash').toggleClass('goodFlash2').toggleClass('badFlash2');
                                    window.setTimeout(function () {
                                        $('#goodFlash').toggleClass('badFlash2').toggleClass('badFlash');
                                    }, 500);
                                }, 3000);
                            }, 500);
                        });
                    } else if (data === 'delete'){

                        (document.querySelector('#name')).innerHTML = remove;
                        window.setTimeout(function () {
                            $('#goodFlash').toggleClass('badFlash').toggleClass('goodFlash').removeClass('alert-warning').addClass('alert-success');
                            window.setTimeout(function () {
                                $('#goodFlash').toggleClass('goodFlash').toggleClass('goodFlash2');
                                window.setTimeout(function () {
                                    $('#goodFlash').toggleClass('goodFlash2').toggleClass('badFlash2');
                                    window.setTimeout(function () {
                                        $('#goodFlash').toggleClass('badFlash2').toggleClass('badFlash');
                                    }, 500);
                                }, 3000);
                            }, 500);
                        });

                    } else {

//   !!!!!!!!!!!!!!!!!!!   Changement de l'opacity du flash avec deux effet en setTimeout   !!!!!!!!!!!!!!!!!!!!!!!

                        (document.querySelector('#name')).innerHTML = dopple;
                        window.setTimeout(function () {
                            $('#goodFlash').toggleClass('badFlash').toggleClass('goodFlash').removeClass('alert-success').addClass('alert-warning');
                            window.setTimeout(function () {
                                $('#goodFlash').toggleClass('goodFlash').toggleClass('goodFlash2');
                                window.setTimeout(function () {
                                    $('#goodFlash').toggleClass('goodFlash2').toggleClass('badFlash2');
                                    window.setTimeout(function () {
                                        $('#goodFlash').toggleClass('badFlash2').toggleClass('badFlash');
                                    }, 500);
                                }, 3000);
                            }, 500);
                        });
                    }

                }
            });

        });
    </script>
    <script>
//   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!   Redirection vers la liste d'animé quand on modif   !!!!!!!!!!!!!!!!!!!

        $(document).submit(function () {
            $('#update').onclick = setTimeout(function () {
                window.location.href = '{{ path('list_anime') }}'
            }, 4500)
        })

    </script>
{% endblock %}
